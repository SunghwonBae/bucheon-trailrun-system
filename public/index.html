<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ë¶€ì²œíŠ¸ë¼ì´ íŠ¸ë ˆì¼ëŸ¬ë‹ ê³„ì¸¡</title>
    <style>
        body { font-family: sans-serif; background: #f0f2f5; margin: 0; padding: 20px; }
        .container { max-width: 600px; margin: 0 auto; }
        .input-box { background: #fff; padding: 20px; border-radius: 12px; text-align: center; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        input { width: 80%; font-size: 30px; padding: 10px; text-align: center; border: 2px solid #0A317E; border-radius: 8px; margin-bottom: 10px; }
        .list-section { margin-top: 20px; }
        table { width: 100%; background: #fff; border-collapse: collapse; border-radius: 8px; overflow: hidden; }
        th, td { padding: 12px; border-bottom: 1px solid #eee; text-align: center; }
        th { background: #0A317E; color: white; }
        .finished { background-color: #d4edda; animation: highlight 1s ease; }
        @keyframes highlight { from { background: #fff3cd; } to { background: #d4edda; } }
    </style>
</head>
<body>
    <div class="container">
        <div class="input-box">
            <h2>ğŸ ë°°ë²ˆ ì…ë ¥</h2>
            <input type="number" id="bibInput" inputmode="numeric" placeholder="000" autofocus>
            <p>ë²ˆí˜¸ ì…ë ¥ í›„ Enterë¥¼ ëˆ„ë¥´ì„¸ìš”</p>
        </div>

        <div class="list-section">
            <h3>ğŸƒ ì‹¤ì‹œê°„ ë„ì°© ìˆœìœ„</h3>
            <table>
                <thead>
                    <tr><th>ë°°ë²ˆ</th><th>ì´ë¦„</th><th>ê¸°ë¡</th></tr>
                </thead>
                <tbody id="resultTable"></tbody>
            </table>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        const bibInput = document.getElementById('bibInput');
        const resultTable = document.getElementById('resultTable');

        // ì´ˆê¸° ë°ì´í„° ë¡œë“œ
        fetch('/api/runners')
            .then(res => res.json())
            .then(runners => {
                runners.filter(r => r.finishTime).forEach(r => addRow(r));
            });

        // ë°°ë²ˆ ì…ë ¥ ì‹œ ì„œë²„ë¡œ ì „ì†¡
        bibInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && bibInput.value) {
                socket.emit('runner_arrived', bibInput.value);
                bibInput.value = '';
            }
        });

        // ì„œë²„ì—ì„œ ì—…ë°ì´íŠ¸ ìˆ˜ì‹ 
        socket.on('update_board', (runner) => {
            addRow(runner, true);
        });

        socket.on('error_msg', (msg) => alert(msg));

        function addRow(runner, isNew = false) {
            const time = new Date(runner.finishTime).toLocaleTimeString('ko-KR', { hour12: false });
            const row = `
                <tr id="row-${runner.bibNumber}" class="${isNew ? 'finished' : ''}">
                    <td>${runner.bibNumber}</td>
                    <td>${runner.name || '-'}</td>
                    <td>${time}</td>
                </tr>`;
            resultTable.insertAdjacentHTML('afterbegin', row);
        }
    </script>
</body>
</html>