<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ë¶€ì²œíŠ¸ë¼ì´ ì‚°ì•…ë§ˆë¼í†¤ëŒ€íšŒ - ê¸°ë¡ì¦</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Gowun+Batang:wght@400;700&display=swap');

        body { font-family: 'Gowun Batang', serif; background: #f0f0f0; margin: 0; padding: 20px; }
        
        /* ì„¤ì •ì°½ ìŠ¤íƒ€ì¼ (ì¶œë ¥ ì‹œ ìˆ¨ê¹€) */
        .config-panel { 
            background: white; padding: 20px; border-radius: 10px; 
            margin-bottom: 30px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); 
        }
        .config-panel h3 { margin-top: 0; }
        .config-input { margin-bottom: 10px; display: flex; gap: 10px; align-items: center; }
        .config-input input { padding: 8px; width: 300px; border: 1px solid #ddd; }

        /* ìƒì¥ ìš©ì§€ ìŠ¤íƒ€ì¼ */
        .certificate-paper {
            width: 210mm; height: 297mm; /* A4 ì‚¬ì´ì¦ˆ */
            background: white; margin: 0 auto 20px auto;
            padding: 20mm; box-sizing: border-box;
            border: 15px double #c9a55c; /* ìƒì¥ í…Œë‘ë¦¬ */
            position: relative; display: flex; flex-direction: column; align-items: center;
        }

        .cert-title { font-size: 50px; font-weight: bold; margin-top: 50px; letter-spacing: 15px; }
        .cert-category { font-size: 24px; margin-top: 60px; }
        .cert-info { font-size: 30px; margin-top: 20px; }
        .cert-content { 
            font-size: 26px; line-height: 1.8; margin-top: 60px; 
            text-align: justify; width: 80%; text-justify: inter-word;
        }
        .cert-date { font-size: 22px; margin-top: 80px; }
        .cert-host { font-size: 32px; font-weight: bold; margin-top: 50px; }

        button { padding: 10px 20px; background: #2c3e50; color: white; border: none; cursor: pointer; border-radius: 5px; }

        /* ì¶œë ¥ ì‹œ ì„¤ì •ì°½ ë° ë²„íŠ¼ ìˆ¨ê¸°ê¸° */
        @media print {
            .config-panel, button, .no-print { display: none !important; }
            body { background: white; padding: 0; }
            .certificate-paper { margin: 0; border: none; page-break-after: always; }
        }
    </style>
</head>
<body>
    <div class="config-panel">
        <h3>ğŸ† ê¸°ë¡ì¦ ë¬¸êµ¬ ì„¤ì •</h3>
        <div class="config-input">
            <label>ëŒ€íšŒ ëª…ì¹­:</label>
            <input type="text" id="input_raceName" value="2026ë…„ ë¶€ì²œì‹œì˜ì¥ë°° ì² ì¸3ì¢… íŠ¸ë ˆì¼ëŸ°ëŒ€íšŒ" oninput="syncText()">
        </div>
        <div class="config-input">
            <label>ë¶€ë¬¸(ì œëª©):</label>
            <input type="text" id="input_category" value="ì™„ì£¼ ê¸°ë¡ì¦" oninput="syncText()">
        </div>
        <div class="config-input">
            <label>ìƒì¥ ë³¸ë¬¸:</label>
            <input type="text" id="input_content" value="ìœ„ ì‚¬ëŒì€ ë¶€ì²œì¢…í•©ìš´ë™ì¥ì—ì„œ ê°œìµœëœ ë³¸ ëŒ€íšŒì—ì„œ ìœ„ì™€ ê°™ì€ ê¸°ë¡ìœ¼ë¡œ ì™„ì£¼í•˜ì˜€ìœ¼ë¯€ë¡œ ì´ ì¦ì„œë¥¼ ìˆ˜ì—¬í•©ë‹ˆë‹¤." oninput="syncText()" style="width: 600px;">
        </div>
        <div class="config-input">
            <label>ìˆ˜ì—¬ ë‚ ì§œ:</label>
            <input type="text" id="input_date" value="2026ë…„ 3ì›” 21ì¼" oninput="syncText()">
        </div>
        <div class="config-input">
            <label>ì£¼ìµœ ê¸°ê´€:</label>
            <input type="text" id="input_host" value="ë¶€ì²œ íŠ¸ë¼ì´ í´ëŸ½ íšŒì¥ ì¥ ê²½ì¼" oninput="syncText()">
        </div>
        <hr>
        <button onclick="window.print()">ğŸ–¨ï¸ ì¸ì‡„í•˜ê¸°</button>
        <button onclick="window.close()" style="background:#7f8c8d">âŒ ë‹«ê¸°</button>
    </div>

    <div id="certContainer"></div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        const urlParams = new URLSearchParams(window.location.search);
        const bib = urlParams.get('bib');

                        // [ìë™ ì„¤ì •] í˜„ì¬ ì—°ë„ ì ìš©
        const currentYear = new Date().getFullYear();
        document.title = `${currentYear} ë¶€ì²œíŠ¸ë¼ì´ ì‚°ì•…ë§ˆë¼í†¤ëŒ€íšŒ - ê¸°ë¡ì¦`;


        // í˜ì´ì§€ ë¡œë“œ ì‹œ í•´ë‹¹ ì„ ìˆ˜ ì •ë³´ ìš”ì²­
        socket.emit('get_runner_info', bib);

        socket.on('runner_info_res', (runner) => {
            if (!runner) {
                alert("ì„ ìˆ˜ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
                return;
            }

            const html = `
                <div class="certificate-paper">
                    <div class="cert-title">ê¸° ë¡ ì¦</div>
                    <div class="cert-category display_category"></div>
                    <div class="cert-info">
                        ë°° ë²ˆ : ${runner.bibNumber} &nbsp;&nbsp; ì„± ëª… : ${runner.name}<br>
                        ê¸° ë¡ : ${runner.finishRecord}
                    </div>
                    <div class="display_raceName" style="font-size:1.5rem; margin-top:40px; font-weight:bold;"></div>
                    <div class="cert-content display_content"></div>
                    <div class="cert-date display_date"></div>
                    <div class="cert-host display_host"></div>
                </div>
            `;
            
            document.getElementById('certContainer').innerHTML = html;
            syncText(); // ì´ˆê¸° í…ìŠ¤íŠ¸ ë™ê¸°í™”
        });

        // ì„¤ì •ì°½ì˜ í…ìŠ¤íŠ¸ë¥¼ ìƒì¥ì— ì‹¤ì‹œê°„ ë°˜ì˜
        function syncText() {
            const fields = ['raceName', 'category', 'content', 'date', 'host'];
            fields.forEach(field => {
                const val = document.getElementById('input_' + field).value;
                document.querySelectorAll('.display_' + field).forEach(el => {
                    el.innerText = val;
                });
            });
        }
    </script>
</body>
</html>